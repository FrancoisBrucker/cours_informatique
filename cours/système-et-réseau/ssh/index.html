<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ssh</title>

    

    <link href="https://prismjs.catppuccin.com/latte.css" rel="stylesheet">

    <link href="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
    <script src="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script>
    
    <link href="/cours_informatique/assets/stylesheets/main.css" rel="stylesheet">

  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };

      function goTop() {
        window.scrollTo({top: 0});
      }
      function goBottom() {
        window.scrollTo({top: document.body.scrollHeight});
      }
    </script>
    <script type="text/javascript" id="MathJax-script" src="/cours_informatique/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/cours_informatique/">Home</a>
        </div>

        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <a class="mx-2" href="/cours_informatique/about">About</a>
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </header>

    <main class="max-w-[1200px] mx-auto px-4">
      
<article>

  <h1>ssh</h1>
  <div>
    

    
  </div>

  

    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a class="interne" href="/cours_informatique/cours/">Cours</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/">Système et réseau</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/ssh/">ssh</a>

</div></div>



    
  

  <blockquote>
<p>TBD voir comment les connexion ne peuvent pas se faire via un docker.</p>
</blockquote>
<blockquote>
<p>TBD refaire avec ici juste ssh login et scp. Pour se connecter et copier
TBD montrer comment ça marche avec vscode et -J</p>
<ol>
<li>création de la clé</li>
<li>accéder à ses clés publiques et privées dans le dossier caché .ssh</li>
<li>sert d'identification à github ou de connexion à une machine distante</li>
<li>nécessité d'un agent</li>
<li>un sas et l'option -J</li>
</ol>
</blockquote>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
<div class="pl-8 mr-8">
<p>On supposera ici que vous êtes étudiant de l'ecm et que vous avez accès aux salles unix de l'école via un login et un mot de passe.</p>
</div></div>

<h2>Connexion sécurisée</h2>
<blockquote>
<p>TBD port 22 de la machine
ssh login@machine
scp <chemin relatif="" local=""> login@machine:<chemin relatif="" distant=""> (ou le contraire)</chemin></chemin></p>
</blockquote>
<blockquote>
<p>TBD chiffrement symétrique rapide
TBD est-on certain de la machine sur laquelle on se connecte ?</p>
</blockquote>
<blockquote>
<p>TBD d'une machine à l'autre dans une salle : <code>$ uname -n</code>
TBD d'une machine au sas : <code>$ uname -n</code>
TBD schéma entrée via le sas : seul port ouvert est le 22 celui de ssh.</p>
</blockquote>
<h2>Identification</h2>
<h3>Machine distante</h3>
<blockquote>
<p><code class="fichier">~/.ssh/known_hosts</code></p>
</blockquote>
<h3>Se créer une paire de clé</h3>
<h3>Utiliser la clé pour se connecter</h3>
<blockquote>
<p>TBD <code class="fichier">~/.ssh/authorized_keys</code>
TBD on voit qu'il demande la passphrase et plus le mot de passe du login</p>
</blockquote>
<h2>Agent</h2>
<p>Utilisation (basique) du logiciel ssh. On va voir deux usages important :</p>
<ul>
<li>se connecter à une machine distante sur le réseau en assurant un chiffrement de la transmission</li>
<li>permettre de s'identifier via une paire de clé publique/privée.</li>
</ul>
<h2>Client</h2>
<p>La client ssh est une commande nommée  <code>ssh</code> accessible via le terminal :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">$<span class="token operator">></span> <span class="token function">ssh</span>
usage: <span class="token function">ssh</span> <span class="token punctuation">[</span>-46AaCfGgKkMNnqsTtVvXxYy<span class="token punctuation">]</span> <span class="token punctuation">[</span>-B bind_interface<span class="token punctuation">]</span> <span class="token punctuation">[</span>-b bind_address<span class="token punctuation">]</span>
           <span class="token punctuation">[</span>-c cipher_spec<span class="token punctuation">]</span> <span class="token punctuation">[</span>-D <span class="token punctuation">[</span>bind_address:<span class="token punctuation">]</span>port<span class="token punctuation">]</span> <span class="token punctuation">[</span>-E log_file<span class="token punctuation">]</span>
           <span class="token punctuation">[</span>-e escape_char<span class="token punctuation">]</span> <span class="token punctuation">[</span>-F configfile<span class="token punctuation">]</span> <span class="token punctuation">[</span>-I pkcs11<span class="token punctuation">]</span> <span class="token punctuation">[</span>-i identity_file<span class="token punctuation">]</span>
           <span class="token punctuation">[</span>-J destination<span class="token punctuation">]</span> <span class="token punctuation">[</span>-L address<span class="token punctuation">]</span> <span class="token punctuation">[</span>-l login_name<span class="token punctuation">]</span> <span class="token punctuation">[</span>-m mac_spec<span class="token punctuation">]</span>
           <span class="token punctuation">[</span>-O ctl_cmd<span class="token punctuation">]</span> <span class="token punctuation">[</span>-o option<span class="token punctuation">]</span> <span class="token punctuation">[</span>-P tag<span class="token punctuation">]</span> <span class="token punctuation">[</span>-p port<span class="token punctuation">]</span> <span class="token punctuation">[</span>-Q query_option<span class="token punctuation">]</span>
           <span class="token punctuation">[</span>-R address<span class="token punctuation">]</span> <span class="token punctuation">[</span>-S ctl_path<span class="token punctuation">]</span> <span class="token punctuation">[</span>-W host:port<span class="token punctuation">]</span> <span class="token punctuation">[</span>-w local_tun<span class="token punctuation">[</span>:remote_tun<span class="token punctuation">]</span><span class="token punctuation">]</span>
           destination <span class="token punctuation">[</span>command <span class="token punctuation">[</span>argument <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre>
<h3>Agent</h3>
<p>La seule chose à possiblement faire est de mettre en place le <a href="https://en.wikipedia.org/wiki/Ssh-agent">ssh-agent</a>. L'agent est un démon permettant de gérer sos clés pour vous.</p>
<p>Pour savoir si vous avez un agent ssh opérationnel, tapez la commande :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">ssh-add <span class="token parameter variable">-l</span></code></pre>
<p>Si cette commande répond :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">$ ssh-add <span class="token parameter variable">-l</span>
Could not <span class="token function">open</span> a connection to your authentication agent.
</code></pre>
<p>C'est que vous n'avez pas d'agent, il va vous falloir en créer un.</p>
<h4>Création sous windows/wsl</h4>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="https://davidaugustat.com/windows/windows-11-setup-ssh">https://davidaugustat.com/windows/windows-11-setup-ssh</a></p>
</div></div>

<p>Les dernières versions de windows viennent avec tout ssh d'installé. Il faut juste faire en sorte que l'Agent ssh soit lancé au démarrage (on suit le tuto de <a href="https://docs.microsoft.com/fr-fr/windows-server/administration/openssh/openssh_keymanagement">gestion des clés OpenSSH</a>).</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Ouvrez un fenêtre <strong>powershell en mode administrateur</strong> (clique droit sur le drapeau, puis choisissez <em>powershell (admin)</em>), puis tapez les commandes :</p>
<pre class="language-powershell" tabindex="0" data-language="powershell"><code class="language-powershell"><span class="token comment"># Set the sshd service to be started automatically</span>
<span class="token function">Get-Service</span> <span class="token operator">-</span>Name ssh-agent <span class="token punctuation">|</span> <span class="token function">Set-Service</span> <span class="token operator">-</span>StartupType Automatic

<span class="token comment"># Now start the sshd service</span>
<span class="token function">Start-Service</span> ssh-agent</code></pre>
</div></div>

<p>L'agent fonctionne différemment sous windows que sous un système unix. Mais normalement, il devrait être reconnu, en particulier par git.</p>
<h4>Création sous Linux</h4>
<p>A priori l'agent est déjà effectif mais si ce n'est pas le cas.
Il faut lancer l'agent à la connexion de chaque shell. Via la commande :</p>
<pre class="language-shell" tabindex="0" data-language="shell"><code class="language-shell">$ <span class="token builtin class-name">eval</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>ssh-agent <span class="token parameter variable">-s</span><span class="token variable">)</span></span>"</span></code></pre>
<p>Si vous ne voulez pas le faire dans chaque terminal, la façon la plus simple est d'ajouter la ligne précédente à la à la fin de votre <code class="fichier">~/.profile</code> (s'il n'existe pas créez le) :</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Dans un terminal, tapez la commande :</p>
<pre class="language-shell" tabindex="0" data-language="shell"><code class="language-shell">$ <span class="token builtin class-name">echo</span> <span class="token string">'eval "$(ssh-agent -s)"'</span> <span class="token operator">>></span> <span class="token environment constant">$HOME</span>/.profile</code></pre>
</div></div>

<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Si vous voulez plus d'options vous pouvez aussi copier-coller le contenu de ce lien : <a href="https://gist.github.com/gabetax/3756756">ajout ssh-agent</a></p>
</div></div>

<h2>ssh, c’est quoi ?</h2>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="https://www.youtube.com/watch?v=3-MDtASgSo8">ssh en 10min</a></p>
</div></div>

<p><strong>Secure Shell (SSH)</strong> est à la fois un programme informatique et un protocole de communication sécurisé. Le protocole de connexion impose un échange de clés de chiffrement en début de connexion. Par la suite, tous les segments TCP sont authentifiés et chiffrés. Il devient donc impossible d'utiliser un sniffer pour voir ce que fait l'utilisateur. Il utilise <a href="../tls" class="interne">tls</a> pour les connexions entre ordinateurs.</p>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<ul>
<li><a href="https://info.support.huawei.com/info-finder/encyclopedia/en/SSH.html">ssh handshake</a></li>
<li><a href="https://bash-prompt.net/guides/bash-ssh-ciphers/">chiffrements utilisés</a></li>
</ul>
</div></div>

<p>On utilise ssh pour garantir de l'authenticité et des ordinateurs sur lesquels on se connecte et des utilisateur qui s'y connecte. Il y aura ainsi essentiellement 2 jeux de clés asymétriques :</p>
<ol>
<li>la paire de clé identifiant l'ordinateur sur lequel un utilisateur veut se connecter</li>
<li>la paire de clé identifiant l'utilisateur</li>
</ol>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<ol>
<li><a href="https://www.youtube.com/watch?v=QGixbJ9prEc&amp;list=PLQqbP89HgbbYIarPqOU8DdC2jC3P3L7a6">ssh en 5 parties</a></li>
<li><a href="https://www.youtube.com/watch?v=hQWRp-FdTpc">ssh crash course</a></li>
<li><a href="https://tusharf5.com/posts/ssh-deep-dive/">deep dive</a></li>
</ol>
</div></div>

<h2>Connexion</h2>
<p>Supposons que je veuille me connecter à une machine distante dont je connais le nom : <code>roucas100.etu.ec-m.fr</code> (cette machine n'est accessible que si vous êtes déjà sur le réseau de l'école centrale méditerranée).</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p><strong>Connection depuis l'extérieur</strong></p>
</div><div class="pl-8 mr-8">
<p>Si vous n'êtes pas initialement connecté sur le réseau de l'école, remplacez <code>roucas100.etu.ec-m.fr</code> par <code>sas1.ec-m.fr</code> qui est l'ordinateur accessible depuis internet.</p>
</div></div>

<p>Je dois me connecter en tant qu'utilisateur de cette machine. Pour cela la connection s'effectue toujours en utilisant le schéma d'une URL : <code>identifiant@machine</code>. Dan sle cs présent :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh"><span class="token function">ssh</span> fbrucker@roucas100.etu.ec-m.fr</code></pre>
<p>Si c'est la première fois que je me connecte à cette machine, <code>ssh</code> me montre la clépublique de la machine <code>roucas100</code> et me demande de l'identifier :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">$ <span class="token function">ssh</span> fbrucker@roucas100.etu.ec-m.fr
The authenticity of <span class="token function">host</span> <span class="token string">'roucas100.etu.ec-m.fr (147.94.25.100)'</span> can't be established.
ED25519 key fingerprint is SHA256:Jf65ebUXhQ1w6+zcCnL8R9cvBMEI8yDvcR+GxtvSHZg.
This key is not known by any other names.
Are you sure you want to <span class="token builtin class-name">continue</span> connecting <span class="token punctuation">(</span>yes/no/<span class="token punctuation">[</span>fingerprint<span class="token punctuation">]</span><span class="token punctuation">)</span>?</code></pre>
<p>On voit que la clé est de type <a href="https://fr.wikipedia.org/wiki/EdDSA">ED25519</a> qui est un chiffrement par courbe elliptique (celle d'Edwards tordue). Si je peux certifier que c'est bien la machine sur laquelle je veux m'identifier, je tape <code>yes</code> et peut taper mon mot de passe pour me connecter.</p>
<p>Si la clé de la machine change cela peut-être à cause d'une attaque de type <em>man in the middle</em> et ssh refuse de se connecter :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">$ <span class="token function">ssh</span> fbrucker@roucas100.etu.ec-m.fr
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED<span class="token operator">!</span>     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY<span class="token operator">!</span>
Someone could be eavesdropping on you right now <span class="token punctuation">(</span>man-in-the-middle attack<span class="token punctuation">)</span><span class="token operator">!</span>
It is also possible that a <span class="token function">host</span> key has just been changed.
The fingerprint <span class="token keyword">for</span> the ED25519 key sent by the remote <span class="token function">host</span> is
SHA256:Jf65ebUXhQ1w6+zcCnL8R9cvBMEI8yDvcR+GxtvSHZg.
Please contact your system administrator.
Add correct <span class="token function">host</span> key <span class="token keyword">in</span> /users/home3/fbrucker/.ssh/known_hosts to get rid of this message.
Offending ECDSA key <span class="token keyword">in</span> /users/home3/fbrucker/.ssh/known_hosts:32
Host key <span class="token keyword">for</span> roucas100.etu.ec-m.fr has changed and you have requested strict checking.
Host key verification failed.
</code></pre>
<p>La liste des ordinateurs connus ainsi que leur clé publique (sur lesquels on s'est déjà connecté) est stockée dans le fichier : <code class="fichier">~/.ssh/known_hosts</code>.</p>
<pre><code>       A                   B
     -----               -----
     |   |               |   |
     |   |--------------&gt;|   |
     -----               -----
  known_hosts
clé de machine
</code></pre>
<h2>Identification des utilisateurs</h2>
<p>Il est très utile de laisser ssh nous identifier sans avoir à taper de mots de passe, via notre couple de clé publique/privée.</p>
<h3>Générer une clé</h3>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">ssh-keygen</code></pre>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-red-500 bg-red-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Comme vous allez vous servir de cette clé pour vous connecter automatiquement à des ordinateurs distant, Il <strong><em>faut</em></strong> mettre une passphrase sécurisée à votre clé.</p>
</div></div>

<p>Si vous suivez les comportement par défaut, vous aller créer deux fichier dans votre dossier <code class="fichier">~/.ssh</code> :</p>
<ul>
<li><code>id_ed25519</code> qui contient votre clé privée</li>
<li><code>id_ed25519.pub</code> qui contient votre clé publique</li>
</ul>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Regardez les droits de ces deux fichiers ainsi que du dossier <code>~/.ssh</code>.</p>
</div></div>

<h3>Hash de la clé</h3>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="https://blog.benjojo.co.uk/post/ssh-randomart-how-does-it-work-art">randomart</a></p>
</div></div>

<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">ssh-keygen <span class="token parameter variable">-lv</span></code></pre>
<h3>Stocker sa clé dans l'agent</h3>
<p>Le rôle de l'agent est de stocker votre clé.</p>
<p>Ajouter la :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">ssh-add</code></pre>
<p>L'agent vous demandera de taper votre passphrase pour déchiffrer votre clé, puis l'ajoutera à son trousseau. Et voilà. Votre clé est chargée. vérifiez le en tapant :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">ssh-add <span class="token parameter variable">-l</span></code></pre>
<p>Vous n'aurez plus besoin de taper cette passphrase tant que l'agent sera actif. C'est à dire jusqu'au reboot de votre machine. En démarrant une nouvelle session et en affichant la liste des identités représentées par l'agent avec <code>ssh-add -l</code>, vous obtenez donc le message suivant :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">the agent has no identities</code></pre>
<p>Il faut donc récupérer votre clé ssh là où vous l'avez laissée. Rien de nouveau ici, c'est simplement une routine à prendre.</p>
<h3>Connexion avec agent</h3>
<p>Pour que vous puissiez vous connecter à une machine via vos clés, il faut que votre clé publique soit disponible sur la machine distante, dans le fichier <code class="fichier">~.ssh/authorized-keys</code>. Chaque ligne de ce fichier contient une clé publique qui est autorisée à se connecter.</p>
<p>Connectez vous sur <code>roucas100.etu.ec-m.fr</code> et ajoutez (ou créez) une ligne au fichier <code class="fichier">~.ssh/authorized-keys</code> contenant votre clé publique :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh"><span class="token function">cat</span> id_rsa.pub <span class="token operator">>></span> ~/.ssh/authorized_keys</code></pre>
<p>Vous pouvez ensuite vous déconnecter, puis vous reconnecter sans avoir besoin de taper un mot de passe.</p>
<pre><code>       A                   B
     -----               -----
     |   |               |   |
     |   |--------------&gt;|   |
     -----               -----
  known_hosts        authorized_keys
clé de machine      clé d'utilisateur
</code></pre>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Faire cette procédure pour vous connecter sans mot de passe.</p>
</div></div>

<h3>Stockage des clés</h3>
<p>Il est de coutume de stocker ses clés sur un ordinateur accessible de l'internet. Il est alors possible d'y accéder depuis de multiple ordinateurs sans avoir à dupliquer la clé.</p>
<p>Pour cela, il fut pouvoir se connecter sur la machine distance en <em>emportant l'agent avec soit</em>. Ceci se fait en ajoutant l'option <code>-A</code> à la connection ssh. Le principe est alors le suivant :</p>
<ol>
<li>accès à l'ordinateur possédant les clés avec <strong>notre propre</strong> agent : <code>ssh -A identifiant@sas1.ec-m.fr</code></li>
<li>ajout de la clé depuis cette machine : <code>ssh-add</code></li>
<li>retour chez soit en se déconnectant de la machine : <code>exit</code></li>
<li>connection à un autre ordinateur où notre clé est autorisée : <code>ssh identifiant@ovh1.ec-m.fr</code></li>
</ol>
<h2>Copie de fichiers</h2>
<p>Pour copier un fichier vers un serveur (et inversement), on utilise donc la commande <code>scp</code>, signifiant <em>Secure Copy Protocol</em>. Cette copie utilise le protocole SSH pour assurer l'authenticité et la confidentialité du transfert. Elle s'utilise de la même manière que <code>cp</code> :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh"><span class="token function">scp</span> <span class="token punctuation">[</span>option<span class="token punctuation">]</span> fichier_source fichier_destination</code></pre>
<p>Pour l'essayer, créez un index.html sur votre machine et copiez-le vers <code>ovh1.ec-m.fr</code> dans le dossier www/.</p>
<p>Depuis votre machine (sans être déjà connecté à <code>ovh1.ec-m.fr</code>), ça donne :</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh"><span class="token function">scp</span> chemin/index.html mon_herbe@aioli.ec-m.fr:static/index.html</code></pre>
<p>Si vous allez vérifier sur <code>aioli.ec-m.fr</code>, votre fichier a bien remplacé l'ancien index.html.</p>
<h2>Exercices</h2>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-fuchsia-500 bg-fuchsia-100">
  <svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-fuchsia-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"></path>
  </svg>
<div class="pl-8 mr-8">
<p><a href="exercices-connexion" class="interne">exercices</a></p>
</div></div>



</article>
    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            Cours d'informatique de François Brucker
          </p>
        </div>
        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>