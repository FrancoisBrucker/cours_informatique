<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>FAT</title>

    <link href="/cours_informatique/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
    <link href="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

    <link href="/cours_informatique/assets/stylesheets/main.css" rel="stylesheet">

  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };

      function goTop() {
        window.scrollTo({top: 0});
      }
      function goBottom() {
        window.scrollTo({top: document.body.scrollHeight});
      }
    </script>
    <script type="text/javascript" id="MathJax-script" src="/cours_informatique/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/cours_informatique/">Home</a>
        </div>

        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <a class="mx-2" href="/cours_informatique/about">About</a>
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </header>

    <main class="max-w-[1200px] mx-auto px-4">
      
<article>

  <h1>FAT</h1>
  <div>
    

    
  </div>

  

    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a class="interne" href="/cours_informatique/cours/">Cours</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/">Système et réseau</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/système-exploitation/">Système d&#39;exploitation</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/système-exploitation/système-fichiers/">Système de fichiers</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/système-exploitation/système-fichiers/FAT/">FAT</a>

</div>
</div>


    
  

  <p>Le <a href="https://fr.wikipedia.org/wiki/File_Allocation_Table">format FAT</a> existe depuis l'aube de l'informatique. On utilise principalement le format :</p>
<ul>
<li><a href="https://fr.wikipedia.org/wiki/FAT32">FAT32</a> pour les partitions de boot et les clé USB de moins de 32GiB</li>
<li><a href="https://en.wikipedia.org/wiki/ExFAT">exFat</a> pour les clés USB de taille supérieure à 32GiB</li>
</ul>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="http://ntfs.com/exfat-comparison.htm">Comparaison FAT32 et exFAT</a></p>
</div>
</div>
<p>Le format exFat étant essentiellement une mise à jour du format FAT32, c'est lui que nous allons présenter (et donnerons lorsque c'est nécessaire les différence d'avec le format FAT32).</p>
<h2>Principe</h2>
<p>Chaque ficher est stocké dans une suite de blocs du disque dur. Un bloc est un multiple d'un secteur physique et correspond à un découpage logique du disque. Le nombre maximum de bloc est fixé par le format, pour augmenter la taille de ce que l'on peut stocker on augmente la taille des blocs (de 4Kib, à 32MiB).</p>
<p>La FAT est un tableau de taille égale au nombre de bloc auto-référant se comportant comme une liste chaînée contenant les bloc sde tous les fichiers qui y sont stockés.</p>
<p>Par exemple, en considérant la FAT ce-dessous de taille 8 :</p>
<pre><code>index valeur
0    :  2
1    :  8       
2    :  3
3    :  8
4    :  7
5    :
6    :
7    :  1
</code></pre>
<p>Et que l'on sait que notre file système contient deux fichiers, l'un commençant bloc 0, l'autre en 4, on en conclut que :</p>
<ul>
<li>le fichier commençant en 0 possède les blocs 0, 2, 3</li>
<li>le fichier commençant en 4 possède les blocs 4, 7, 1</li>
</ul>
<p>Les blocs peuvent être de deux types :</p>
<ul>
<li>donnée : ils contiennent une suite de byte formant le fichier</li>
<li>dossier : contient la liste des fichiers/dossiers qu'il contient ainsi que leurs 1er blocs respectifs</li>
</ul>
<p>On stocke donc à la fois les données et la structure en dossier dans les blocs eux même.</p>
<h2>Tailles Limites</h2>
<ul>
<li>FAT32
<ul>
<li>nombre maximum de blocs : $2^{28}$</li>
<li>taille maximum de bloc : 32KiB</li>
<li>taille de fichier codée sur 4B (donc la taille maximale est 4GiB)</li>
<li>nombre maximum de fichiers par dossiers : $2^{16}$</li>
</ul>
</li>
<li>exFAT
<ul>
<li>nombre maximum de blocs : $2^{32}$</li>
<li>taille maximum de bloc : 32MiB</li>
<li>taille de fichier codée sur 8B (donc la taille maximale est 16EiB)</li>
<li>nombre maximum de fichiers par dossiers : virtuellement illimitée</li>
</ul>
</li>
</ul>
<h2>Structure du disque</h2>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="http://elm-chan.org/docs/exfat_e.html">Structure complète de exFAT</a></p>
</div>
</div>
<p>Le découpage de la structure est en 4 parties :</p>
<ol>
<li>Boot Area : contient les informations générales sur le volume</li>
<li>FAT : la fat elle même</li>
<li>bitmap des blocs</li>
<li>blocs de données</li>
</ol>
<h3>Boot Area</h3>
<p>La première partie de la structure, nommé <em>Boot Area</em> contient diverse informations sur le volume. En particulier :</p>
<ul>
<li>la taille d'un secteur (de 512B à 4KiB)</li>
<li>la taille d'un bloc, de 512B à 32MiB et habituellement 4KiB. C'est l'unité de stockage du format FAT</li>
<li>le nombre de blocs du volume, au maximum $2^{32} -11$</li>
</ul>
<p>La <em>Boot Area</em> est contenue sur les 12 premiers secteurs et est dupliquée dans les 12 suivant.</p>
<h3>FAT</h3>
<p>Est constituée d'un tableau de taille égale au nombre de blocs, chaque case du tableau faisant 32b = 4B.</p>
<p>C'est ce tableau qui va permettre de connaître les bloc où sont écrit des données.</p>
<p>Supposons que les données d'un fichier soient écrites sur les blocs numéros 4, 12, 8 et 45 dans cet ordre alors :</p>
<ol>
<li>la case d'indice 4 aura 12 comme valeur,</li>
<li>la case d'indice 12 aura 8 comme valeur,</li>
<li>la case d'indice 8 aura 45 comme valeur,</li>
<li>la case d'indice 8 aura 0xFFFFFFFF comme valeur, signifiant que le fichier s'arrête.</li>
</ol>
<p>Les trois premiers blocs étant intégralement remplis.</p>
<p>Cette structure en liste chaînées permet de reconstituer facilement le contenu d'un fichier si l'on possède son premier bloc.</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Cette partie possède potentiellement un bloc consacrée aux <a href="https://en.wikipedia.org/wiki/Transaction-Safe_FAT_File_System#TexFAT">transactions</a>, pour permettre un système journalisé, mais comme la journalisation n'est pas recommandée pour les disques amovible et que le format FAT ne sert presqu'exclusivement à ça, ce n'est pas utilisé en pratique.</p>
</div>
</div>
<p>La taille de cette partie est donc de 4B fois le nombre de blocs, qui est négligeable par rapport à la taille du disque.</p>
<p>En effet, la taille maximum de la FAT vaut au maximum $4/512 \simeq .7\%$ de la taille totale.</p>
<h3>Bitmap</h3>
<p>Une <a href="https://en.wikipedia.org/wiki/Bitmap">bitmap</a> est associé aux blocs :</p>
<ul>
<li>0 signifie que le bloc est libre</li>
<li>1 que le bloc est occupé</li>
</ul>
<p>Ceci permet de rapidement savoir si un bloc est libre (par exemple, on prend 64b de cette partie et si ce nombre est inférieur au maximum (se fait en un cycle du processeur), il y a des blocs libres parmi les 64 considéré).</p>
<p>La taille de cette partie est le nombre de bloc bits, donc au maximum $1/(512 \cdot 8) \simeq .1\%$ de la taille totale.</p>
<h3>Blocs de données</h3>
<p>Chaque bloc est soit :</p>
<ul>
<li>une entrée pour un dossier</li>
<li>une entrée pour une suite de byte constituant un fichier</li>
</ul>
<h4>Bloc dossier</h4>
<p>Contient une entrée pour chaque dossier ou fichier le constituant, cette entrée détermine :</p>
<ul>
<li>le type d'entrée (fichier ou dossier)</li>
<li>le bloc contenant l'entrée</li>
<li>la taille de l'entrée en byte</li>
</ul>
<p>Renseigner la taille permet de savoir où s'arrêter dans le dernier bloc.</p>
<p>La taille en bloc est déterminée par la FAT.</p>
<h4>Bloc fichier</h4>
<p>Pas de structure, uniquement une suite de byte qui constitue le ficher.</p>
<h2><span id="fat-opérations"></span>Opérations</h2>
<p>l'ajout suppression de fichiers va rendre non linéaire le stockage ds fichiers.</p>
<h3><span id="fat-opérations-ajout">Ajout</span></h3>
<p>On suit la hiérarchie des dossiers jusqu'à arriver au bloc contenant le dossier pour lequel on veut ajouter une entrée. Si ce bloc est plein, on cherche un bloc libre pour étendre l'entrée de ce dossier puis on ajoute l'entrée.</p>
<p>On peut maintenant chercher autant de bloc libre que nécessaire pour stocker le contenu de l'entrée an ajoutant une chaîne à la FAT.</p>
<h3><span id="fat-opérations-suppression">Suppression</span></h3>
<p>On ne supprime que l'entrée dans le dossier contenant le fichier à supprimer. Le contenu reste présent :</p>
<ul>
<li>dans la FAT</li>
<li>sur le disque</li>
</ul>
<p>Il est donc possible de retrouver les données si on cherche directement sur le disque dur.</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Formater le disque dur ne fait que refaire une FAT vierge, le contenu du disque dur n'est pas automatiquement effacé. Il est la aussi possible de chercher les différent bloc pour retrouver le fichier, surtout si les blocs sont continus.</p>
<p>Pour supprimer définitivement des données, il faut re-écrire sur tous les byte du disque dur pour en effacer le contenu (et il faut le faire plusieurs fois pour les disques magnétique à cause de la rémanence des données)</p>
</div>
</div>


</article>
    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            Cours d'informatique à l'école centrale Marseille
          </p>
        </div>
        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>