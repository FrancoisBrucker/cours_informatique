<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Ext4</title>

    <link href="/cours_informatique/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
    <link href="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

    <link href="/cours_informatique/assets/stylesheets/main.css" rel="stylesheet">

  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };

      function goTop() {
        window.scrollTo({top: 0});
      }
      function goBottom() {
        window.scrollTo({top: document.body.scrollHeight});
      }
    </script>
    <script type="text/javascript" id="MathJax-script" src="/cours_informatique/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/cours_informatique/">Home</a>
        </div>

        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <a class="mx-2" href="/cours_informatique/about">About</a>
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </header>

    <main class="max-w-[1200px] mx-auto px-4">
      
<article>

  <h1>Ext4</h1>
  <div>
    

    
  </div>

  

    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a class="interne" href="/cours_informatique/cours/">Cours</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/">Système et réseau</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/système-exploitation/">Système d&#39;exploitation</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/système-exploitation/système-fichiers/">Système de fichiers</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/système-exploitation/système-fichiers/ext/">Ext4</a>

</div></div>



    
  

  <blockquote>
<p>TBD : rendre joli. Faire des dessins d'inode.
bien séparer ext2/3/4</p>
</blockquote>
<p><a href="https://fr.wikipedia.org/wiki/Ext4">ext4</a> est le format standard du système de fichier Linux. Il est une évolution de l'ext3 (il augmente la taille maximale des fichiers et leurs gestion), lui même une évolution d'ext2 (ext3 est ext2 plus la journalisation).</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="https://www.easeus.fr/partition-manager-tips/systeme-de-fichiers-ext2-ext3-ext4.html">https://www.easeus.fr/partition-manager-tips/systeme-de-fichiers-ext2-ext3-ext4.html</a></p>
</div></div>

<h2>Principe</h2>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="https://teaching.idallen.com/cst8207/13w/notes/450_file_system.html">https://teaching.idallen.com/cst8207/13w/notes/450_file_system.html</a></p>
</div></div>

<p>Plutôt que d'avoir une structure linéaire globale où sont stockés les structures de tous les fichiers (comme la FAT), ext utilise pour chaque fichier une structure arborée nommée <a href="https://fr.wikipedia.org/wiki/N%C5%93ud_d'index">inode</a> qui contient à la fois les méta données et la structure de stockage.</p>
<h2>Format</h2>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="(https:/ext4.wiki.kernel.org/index.php/Ext4_Disk_Layout)">Structure complète de ext4</a></p>
</div></div>

<p>Le découpage de la structure est en 6 parties :</p>
<ol>
<li>superblock (taille 1 bloc)</li>
<li>groupes (taille variable de plusieurs bloc)</li>
<li>bitmap des blocs (taille 1 bloc)</li>
<li>bitmap des inodes (taille 1 bloc)</li>
<li>liste des inodes (taille variable de plusieurs bloc)</li>
<li>blocs de données (taille variable de plusieurs bloc)</li>
</ol>
<h3>superblock</h3>
<p>La première partie de la structure, le superblock contient diverse informations sur le volume. En particulier :</p>
<ul>
<li>la taille d'un bloc, de 1KiB à 64KiB et habituellement 4KiB</li>
<li>le nombres d'inodes du volume, au maximum $2^{32}$</li>
<li>le nombre de blocs du volume, au maximum $2^{32}$</li>
</ul>
<p>Le superblock est dupliqué, pour pouvoir le reconstitué en cas de corruption.</p>
<h3>Groupes</h3>
<p>Les inodes et les blocs sont partitionnés en groupes. Chaque groupe forme un intervalle de blocs, ce qui permet, de limiter la <a href="https://en.wikipedia.org/wiki/File_system_fragmentation">fragmentation</a> si on contraint les fichiers à être stockés avec des blocs du même groupe.</p>
<h3>bitmap des blocs et ds inodes</h3>
<p><a href="https://en.wikipedia.org/wiki/Bitmap">bitmap</a> permettant de trouver un bloc ou un inode libre.</p>
<h3>Table des inodes</h3>
<h4>Table</h4>
<p>un tableau d'inode.  Chaque inode fait une taille par défaut de 256B en ext4 (128B pour ext2 et ext3). Il est impensable d'avoir $2^{32}$, car la table seule ferait $2TiB$. L'usage veut que l'on ait 1/(16KiB) fois la taille du volume inode, ce qui fait $1.5\%$ de la taille totale du disque.</p>
<p>La numérotation des inodes commence à 1, il n'existe pas d'iode 0.</p>
<h4>Inode</h4>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="https://en.wikipedia.org/wiki/Ext2#Inodes">inode</a></p>
</div></div>

<p>Un inode est une structure permettant de stocker les méta-données et la structure d'un élément du système de fichiers : dossier ou fichier.</p>
<p>Cette structure est composée :</p>
<ul>
<li>méta-données de l'élément :
<ul>
<li>propriétaire</li>
<li>groupe</li>
<li>permissions</li>
<li>dates de création, dernière modification</li>
</ul>
</li>
<li>nombres de référence de cet inode</li>
<li>type d'élément (dossier, fichier ou interface)</li>
<li>blocs :
<ul>
<li>12 adressages direct</li>
<li>1 adressage indirect : un bloc de 128 adresses de blocs</li>
<li>1 adressage doublement indirect : un bloc de 128 adresses indirects</li>
<li>1 adressage triplement indirect : un bloc de 128 adresses doublement indirectes</li>
</ul>
</li>
</ul>
<p>Remarquez que le nom n'est pas présent dans un inode, au contraire du format FAT.</p>
<h3>blocs</h3>
<h4>élément</h4>
<p>dossier : liste de noms plus inodes
permet des lien fort entre plusieurs fichiers qui se retrouvent identique. On incrémente le nombre de référence.</p>
<p>contient toujours . et ..</p>
<p>fichier : stockage</p>
<h4>adressage</h4>
<p>Cette adressage en arbre à deux grandes propriétés :</p>
<ul>
<li>il est compact et tient en cache</li>
<li>on ne stocke que ce dont on a besoin (la FAT stock tout, même ce qui n'existe pas encore)</li>
<li>l'indirection fait qu'on peut stocker beaucoup de chose (on ne fait que 3 étages pour limiter l'overhead)</li>
</ul>
<p>$2^{32}$ blocs et taille de secteur de 512B. On peut stocker 128 adresses de blocs.</p>
<p>Nombre de blocs stockés :</p>
<ul>
<li>simple : $128 = 2^7$ blocs</li>
<li>indirect : $128^2 = 2^{14} = 16 \text{KiB}$ blocs</li>
<li>doublement indirect : $128^3 = 2 \text{MiB}$ blocs</li>
<li>triplement indirect : $128^4 = 256 \text{MiB}$ blocs</li>
</ul>
<p>Notez que l'on ne préremplit pas la structure, on alloue les blocs indirect que si le fichier est assez gros pour en avoir besoin. On ne gâche donc pas de place de stockage (ou si peu).</p>
<p>Avec une taille de bloc de 4KiB$, on arrive à des tailles respectables. De plus ext4 permet de stocker des intervalles contiguë de blocs plutôt qu'une unique  adresse, ce qui rend la taille d'un fichier virtuellement infinie.</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p>élément de design</p>
</div><div class="pl-8 mr-8">
<p>inode :</p>
<ul>
<li>on ne stocke que ce qui est nécessaire</li>
<li>stockage par niveau : l'arbre démultiplie les possibilités de stockage</li>
</ul>
</div></div>

<h2><span id="ext-opérations"></span>Opérations</h2>
<p>la gestion des droit est au cœur du système.</p>
<p>Le cache fait que l'accès va aller vite, on a les tables directement en mémoire. La FAT en entier ne tient pas dedans.</p>
<h3><span id="ext-opérations-ajout">Ajout</span></h3>
<p>idem que pour la FAT</p>
<h3><span id="ext-opérations-suppression">Suppression</span></h3>
<p>On décrémente la référence. et si référence vaut 0, on supprime l'inode.</p>


</article>
    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            Cours d'informatique à l'école centrale Marseille
          </p>
        </div>
        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>