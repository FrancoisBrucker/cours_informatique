<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Sockets réseaux</title>

    <link href="/cours_informatique/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
    <link href="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

    <link href="/cours_informatique/assets/stylesheets/main.css" rel="stylesheet">

  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };

      function goTop() {
        window.scrollTo({top: 0});
      }
      function goBottom() {
        window.scrollTo({top: document.body.scrollHeight});
      }
    </script>
    <script type="text/javascript" id="MathJax-script" src="/cours_informatique/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/cours_informatique/">Home</a>
        </div>

        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <a class="mx-2" href="/cours_informatique/about">About</a>
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </header>

    <main class="max-w-[1200px] mx-auto px-4">
      
<article>

  <h1>Sockets réseaux</h1>
  <div>
    

    
  </div>

  

    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a class="interne" href="/cours_informatique/cours/">Cours</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/">Système et réseau</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système-et-réseau/client-serveur/">Sockets réseaux</a>

</div></div>



    
  

  <blockquote>
<p>Une seule connexion possible. Ensuite, disparait.</p>
</blockquote>
<blockquote>
<p>TBD Faire en shell avec nc
TBD Faire en C :</p>
<ul>
<li>client time ?</li>
<li>client serveur</li>
</ul>
</blockquote>
<blockquote>
<p>TBD limité à 1 connection. En avoir plusieurs possible avec un fork. Le faire</p>
</blockquote>
<ul>
<li><a href="https://www.baeldung.com/linux/unix-vs-tcp-ip-sockets">domain socket vs tcp socket</a></li>
<li><a href="https://beej.us/guide/bgipc/html/#unixsock">code client/serveur simple (unix domain socket)</a></li>
<li><a href="https://beej.us/guide/bgnet/">code client/serveur complet</a></li>
<li><a href="https://www.youtube.com/watch?v=cex9XrZCU14">fork</a></li>
<li><a href="https://www.youtube.com/watch?v=il4N6KjVQ-s">socket et fichier</a></li>
<li>sur la même machine :
<ul>
<li>parent/enfant issu de fork. Comme copie les file descriptor, ce sont les mêmes et on peut utiliser des pipe <a href="https://stackoverflow.com/questions/14170647/fork-parent-child-communication">https://stackoverflow.com/questions/14170647/fork-parent-child-communication</a></li>
<li><a href="https://copyconstruct.medium.com/file-descriptor-transfer-over-unix-domain-sockets-dcbbf5b3b6ec">unix domain socket</a></li>
</ul>
</li>
</ul>
<h2>Connexion internet</h2>
<h3>socket Client / serveur</h3>
<p>la commande <a href="https://doc.fedora-fr.org/wiki/Netcat,_connexion_client/serveur_en_bash"><code>nc</code></a> permet d'établir une connexion TCP à un serveur ou de créer un serveur.</p>
<p>Serveur :</p>
<pre><code>nc -l -p 9090 127.0.0.1
</code></pre>
<p>Client (dans un autre terminal) :</p>
<pre><code>nc 127.0.0.1 9090
</code></pre>
<p>Les stdin/out sont liés.</p>
<p>Nc n'admet qu'une connexion. Pour créer un serveur acceptant plusieurs client, il faut utiliser une autre commande : <a href="https://www.redhat.com/sysadmin/getting-started-socat">socat</a> :</p>
<pre class="language-sh " style="counter-reset: linenumber 0"><code class="language-sh"><span class="token shebang important">#! /bin/sh</span>

socat tcp-listen:9090,fork,reuseaddr <span class="token punctuation">\</span>
<span class="token string">'system:

echo "Le serveur écoute."

while read CLIENT_MESSAGE; do
  echo "le serveur répond : $CLIENT_MESSAGE"
done
'</span>

</code></pre>
<h2>outil de connexion</h2>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="https://www.redhat.com/sysadmin/getting-started-socat">https://www.redhat.com/sysadmin/getting-started-socat</a></p>
</div></div>

<ul>
<li><a href="https://www.varonis.com/blog/netcat-commands">nc</a></li>
<li><a href="https://jameshfisher.com/2018/12/31/how-to-make-a-webserver-with-netcat-nc/">shell server avec nc</a></li>
</ul>
<h3>echo serveur</h3>
<pre class="language-sh " style="counter-reset: linenumber 0"><code class="language-sh"><span class="token shebang important">#! /bin/sh</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> 
    <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">9090</span>
<span class="token keyword">else</span>
    <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token keyword">fi</span>

socat tcp-listen:<span class="token variable">$PORT</span>,fork,reuseaddr <span class="token punctuation">\</span>
<span class="token string">'system:

echo "Le serveur écoute."

while read CLIENT_MESSAGE; do
  echo "le serveur répond : $CLIENT_MESSAGE"
done
'</span>

</code></pre>
<h3>mono ligne</h3>
<pre class="language-sh " style="counter-reset: linenumber 0"><code class="language-sh"><span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">9090</span><span class="token punctuation">;</span> socat tcp-listen:<span class="token variable">$PORT</span>,fork,reuseaddr <span class="token string">'system: while read CLIENT_MESSAGE; do echo "le serveur répond : $CLIENT_MESSAGE"; done'</span>
</code></pre>
<h3>echo à tous serveur</h3>
<pre class="language-sh " style="counter-reset: linenumber 0"><code class="language-sh"><span class="token shebang important">#! /bin/sh</span>

<span class="token function">rm</span> /tmp/pns_* <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">9090</span>
<span class="token keyword">else</span>
    <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token keyword">fi</span>

socat tcp-listen:<span class="token variable">$PORT</span>,fork,reuseaddr <span class="token punctuation">\</span>
<span class="token string">'system:

PIPE=$(mktemp -u /tmp/pns_XXX)
ME=$(echo $PIPE | sed '</span>s:/tmp/pns_::<span class="token string">')
mkfifo $PIPE

while read PIPE_MESSAGE&lt;$PIPE; do
  echo $PIPE_MESSAGE
done &amp;
PID=$!

echo "je suis : $ME"
for EACH_PIPE in $(ls /tmp/pns_*); do
   [ $PIPE != $EACH_PIPE ] &amp;&amp;  echo "$ME est connecté" > $EACH_PIPE
done

while read CLIENT_MESSAGE; do
  for EACH_PIPE in $(ls /tmp/pns_*); do
    echo "Message de $ME : $CLIENT_MESSAGE" > $EACH_PIPE
  done
done
kill $PID
rm $PIPE
'</span>

</code></pre>
<h3>client</h3>
<p>Avec socat :</p>
<pre class="language-sh " style="counter-reset: linenumber 0"><code class="language-sh">socat - TCP4:localhost:9090
</code></pre>
<p>Avec nc :</p>
<pre class="language-sh " style="counter-reset: linenumber 0"><code class="language-sh"><span class="token function">nc</span> localhost <span class="token number">9090</span>
</code></pre>
<h3>web server avec python/socat</h3>
<pre class="language-shell " style="counter-reset: linenumber 0"><code class="language-shell">python <span class="token parameter variable">-m</span> http.serveur <span class="token number">8080</span>
</code></pre>
<blockquote>
<p>TBD en écrire un.</p>
</blockquote>
<blockquote>
<p><a href="https://dev.to/leandronsp/building-a-web-server-in-bash-part-ii-parsing-http-14kg">https://dev.to/leandronsp/building-a-web-server-in-bash-part-ii-parsing-http-14kg</a></p>
</blockquote>
<blockquote>
<p><a href="https://fazlearefin.blogspot.com/2021/05/http-and-https-simple-web-server-using.html">https://fazlearefin.blogspot.com/2021/05/http-and-https-simple-web-server-using.html</a></p>
</blockquote>
<ul>
<li><a href="https://gist.github.com/baleyko/003a089deb4f532552ef674e9ff4cea9">web minimal</a></li>
<li><a href="https://fabianlee.org/2022/10/26/linux-socat-used-as-secure-https-web-server/">https://fabianlee.org/2022/10/26/linux-socat-used-as-secure-https-web-server/</a></li>
<li><a href="https://stuff.mit.edu/afs/sipb/machine/penguin-lust/src/socat-1.7.1.2/EXAMPLES">https://stuff.mit.edu/afs/sipb/machine/penguin-lust/src/socat-1.7.1.2/EXAMPLES</a></li>
</ul>
<h2>bibliographie</h2>
<ul>
<li><a href="https://www.netfilter.org/documentation/HOWTO/networking-concepts-HOWTO.html">Linux Networking-concepts HOWTO</a></li>
<li><a href="https://beej.us/guide/bgnet/">Beej's Guide to Network Programming Using Internet Sockets</a></li>
<li><a href="https://opensource.com/article/19/4/interprocess-communication-linux-networking">https://opensource.com/article/19/4/interprocess-communication-linux-networking</a></li>
</ul>
<h2>client serveur</h2>
<ol>
<li>socat : un serveur en shell qui répond à un protocole simple :
<ol>
<li>répond hello à <code>hello</code></li>
<li>donne l'heure</li>
<li>envoie un fichier s'il existe</li>
</ol>
</li>
<li>node/express, flask, fastAPI :
<ol>
<li>route index.html redirection vers /static/index.html</li>
<li>une route qui calcule une somme</li>
<li>un site static simple</li>
<li>un js dedans qui appelle la fonction à calculer avec un /api/calcul</li>
</ol>
</li>
<li>deux route en hop. Ramener le port 9090 de roucas sur localhost en suivant la route : localhost &lt;-&gt; ovh &lt;-&gt; sas1 &lt;-&gt; roucas101.</li>
</ol>
<ul>
<li><a href="https://github.com/denehs/unix-domain-socket-example/blob/master/client.c">https://github.com/denehs/unix-domain-socket-example/blob/master/client.c</a></li>
<li>tcp socket</li>
<li><a href="https://www.tala-informatique.fr/wiki/index.php/C_socket">https://www.tala-informatique.fr/wiki/index.php/C_socket</a></li>
<li><a href="https://seriot.ch/projects/tiny_ntp_client.html">ntp client</a></li>
<li><a href="https://www.nstec.com/how-to-disable-firewall-iphone-hotspot/">iphone firewall</a></li>
</ul>
<h2>tbd</h2>
<blockquote>
<p>en python : <a href="https://www.youtube.com/watch?v=Ftg8fjY_YWU">https://www.youtube.com/watch?v=Ftg8fjY_YWU</a></p>
</blockquote>
<p><a href="https://www.geeksforgeeks.org/how-to-kill-a-detached-screen-session-in-linux/">https://www.geeksforgeeks.org/how-to-kill-a-detached-screen-session-in-linux/</a></p>
<h3>cours web</h3>
<p>remplacer screen par tmux.</p>
<p>Utiliser un shell que l'on sauve. Comme ça on peut y revenir, par exemple si virtualenv.</p>
<p>faire un exemple complet avec <a href="https://python-guide-pt-br.readthedocs.io/fr/latest/dev/virtualenvs.html">virtualenv</a></p>
<p>faire plusieurs petits serveurs avec :</p>
<ul>
<li>shell</li>
<li>python seul</li>
<li>python + flask + virtualenv</li>
<li>node seul</li>
<li>node + express + package.json</li>
</ul>


</article>
    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            Cours d'informatique à l'école centrale Marseille
          </p>
        </div>
        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>