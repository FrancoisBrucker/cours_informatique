<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Dossiers et chemins</title>

    <link href="/cours_informatique/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
    <link href="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

    <link href="/cours_informatique/assets/stylesheets/main.css" rel="stylesheet">

  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };

      function goTop() {
        window.scrollTo({top: 0});
      }
      function goBottom() {
        window.scrollTo({top: document.body.scrollHeight});
      }
    </script>
    <script type="text/javascript" id="MathJax-script" src="/cours_informatique/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/cours_informatique/">Home</a>
        </div>

        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <a class="mx-2" href="/cours_informatique/about">About</a>
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </header>

    <main class="max-w-[1200px] mx-auto px-4">
      
<article>

  <h1>Dossiers et chemins</h1>
  <div>
    

    
  </div>

  

    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a class="interne" href="/cours_informatique/cours/">Cours</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/algorithme-code-théorie/">Algorithme, code et théorie</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/algorithme-code-théorie/code/">Code</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/algorithme-code-théorie/code/fichiers/">Fichiers</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/algorithme-code-théorie/code/fichiers/dossiers-et-chemins/">Dossiers et chemins</a>

</div>
</div>


    
  

  <!-- début résumé -->
<p>Comment trouver efficacement un fichier dans le système de fichier de l'ordinateur.</p>
<!-- end résumé -->
<p>Par défaut python va chercher les fichiers à ouvrir dans le dossier du fichier python en train d'être exécuté. On peut facilement chercher un fichier dans un dossier spécifique en python.</p>
<p>Commencez par intégrer la règle d'or :</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>On ne présuppose jamais de l'endroit où un fichier est stocké sur un ordinateur.</p>
</div>
</div>
<p>Supposons  que vous ayez un fichier python dans le dossier <code class="fichier">/Users/fbrucker/Documents/mon_projet/main.py</code> et que ce programme python utilise le fichier <code class="fichier">/Users/fbrucker/Documents/mon_projet/donnees.txt</code>.</p>
<p>Si votre programme <code class="fichier">main.py</code> utilise le fichier <code class="fichier">donnees.txt</code> de cette façon :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python">donnees <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/Users/fbrucker/Documents/mon_projet/donnees.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>Il ne pourra fonctionner <strong>que</strong> sur votre ordinateur ! En effet, si vous copiez le dossier <em>&quot;mon_projet&quot;</em>  et tout son contenu  de l'ordinateur A à l'ordinateur B, il est très peu probable qu'il soit placé au même endroit sur le disque dur.</p>
<p>Une première solution est d'utiliser un chemin relatif :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python">donnees <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"donnees.txt"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>On voit que le chemin utilisé est <em>relatif</em> car il ne commence pas par un <code class="fichier">/</code>. On cherche le fichier <code class="fichier">donnees.txt</code> par rapport au dossier courant du terminal qui a exécuté le fichier python. De là, si vous êtes dans le dossier <em>&quot;mon_projet&quot;</em> lorsque vous tapez la commande <code>python main.py</code> votre programme marchera sur tous les ordinateurs.</p>
<p>Si cette technique fonctionne souvent, elle n'est cependant pas optimale car vous ne pouvez pas garantir que votre programme sera <strong>toujours</strong> exécuté depuis le dossier <code class="fichier">mon_projet/</code>. S'il est par exemple exécuté depuis le parent de <code class="fichier">mon_projet/</code> : <code>python mon_projet/main.py</code> ; votre code ne fonctionnera plus puisque le dossier par défaut ne sera plus le bon...</p>
<p>La solution qui fonctionne tout le temps est de déterminer à l'exécution l'emplacement du fichier*&quot;<a href="http://main.py">main.py</a>&quot;*. Ceci se fait grâce à la variable spéciale : <code class="language-">__file__</code>.</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Copiez le code suivant dans un fichier et exécutez le pour voir le fonctionnement de la variable <code class="language-">__file__</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span>
</code></pre>
</div>
</div>
<p>On n'a fait que la moitié du chemin, puisque l'on a l'emplacement du fichier, mais pas le dossier. Ceci peut se faire en utilisant le module <a href="https://docs.python.org/fr/3/library/os.path.html"><code>os.path</code> de python</a> :</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Copiez le code suivant dans un fichier et exécutez le pour voir comment récupérer le dossier à partir de <code class="language-">__file__</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">import</span> os

<span class="token keyword">print</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span> <span class="token comment"># le chemin absolu jusqu'au fichier</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># le dossier</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># le nom du fichier                                     </span>
</code></pre>
</div>
</div>
<p>Cette méthode permet d'obtenir un chemin absolu de référence pour garantir l'accès aux fichiers de données sur toutes les machines où votre projet sera copié.</p>
<p>Un fois un dossier de référence trouvé, on pourra l'utiliser pour accéder à nos données. Mais <strong>jamais</strong> à la main :</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Lorsque l'on manipule des fichiers ou que l'on combine des dossiers on utilise <strong>toujours</strong> une bibliothèque dédiée pour cela, on ne manipule <strong>jamais</strong> les noms de fichiers et de dossiers en utilisant des méthodes de chaînes de caractères</p>
</div>
</div>
<p>On va voir deux façons de faire en python, l'une classique avec le module <a href="https://docs.python.org/fr/3/library/os.path.html">os.path</a>, l'autre plus moderne qui utilise le module <a href="https://docs.python.org/fr/3/library/pathlib.html">pathlib</a>.</p>
<h2>Module <code class="language-">os.path</code></h2>
<p>On suppose que la variable <code class="language-">__file__</code> corresponde au chemin <code class="fichier">/Users/fbrucker/Documents/mon_projet/main.py</code> sur le disque dur. On suppose aussi que le module <code class="language-">os</code> a été importé.</p>
<ul>
<li>rendre le dossier où est <code class="language-">__file__</code> avec <a href="https://docs.python.org/fr/3/library/os.path.html#os.path.dirname">dirname</a> : <code class="language-">dossier = os.path.dirname(__file__)</code>.</li>
<li>rendre le nom du fichier pointé par <code class="language-">__file__</code> avec <a href="https://docs.python.org/fr/3/library/os.path.html#os.path.basename">basename</a> : <code class="language-">nom_fichier = os.path.basename(__file__)</code></li>
<li>concaténer deux chemins avec <a href="https://docs.python.org/fr/3/library/os.path.html#os.path.join">join</a> : <code class="language-">os.path.join(&quot;/Users/fbrucker&quot;, &quot;Documents/mon_projet&quot;)</code> rendra : <code class="fichier">/Users/fbrucker/Documents/mon_projet</code></li>
<li>rendre le dossier parent : <code class="language-">os.path.join(dossier, &quot;..&quot;)</code>.</li>
<li>rendre le chemin absolu à partir d'un chemin relatif : <code class="language-">os.path.abspath(&quot;.&quot;)</code></li>
</ul>
<h2>Module <code class="language-">pathlib</code></h2>
<p>Le module <a href="https://docs.python.org/fr/3/library/pathlib.html">pathlib</a> permet d'avoir une approche objet de la manipulation des fichiers.</p>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-fuchsia-500 bg-fuchsia-100">
  <svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-fuchsia-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"></path>
  </svg>
<div class="pl-8 mr-8">
<p><a href="https://jefftriplett.com/2017/pathlib-is-wonderful/">Ce tutoriel</a> est parfait pour vous montrer comment l'utiliser.</p>
</div>
</div>
<h2><span id="fichiers-distants"></span>Fichiers distants</h2>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="https://requests.readthedocs.io/en/latest/">Module requests</a></p>
</div>
</div>
<p>Les fichiers stockés sur internet peuvent aussi être récupérés en python <em>via</em> leur <a href="https://fr.wikipedia.org/wiki/Uniform_Resource_Locator">url</a>. On utilise la bibliothèque <a href="https://requests-fr.readthedocs.io/en/latest/">requests</a> (<code>python -m pip install requests</code>).</p>
<p>Par exemple, le site <a href="https://www.gutenberg.org">https://www.gutenberg.org</a> possède de nombreux livres au format utf-8 à télécharger. Par exemple <a href="https://www.gutenberg.org/ebooks/14155">https://www.gutenberg.org/ebooks/14155</a> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">import</span> requests

page <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://www.gutenberg.org/ebooks/14155.txt.utf-8"</span><span class="token punctuation">)</span>
</code></pre>
<p>Le code précédent à téléchargé le fichier contenu dans l'url <a href="https://www.gutenberg.org/ebooks/14155.txt.utf-8">https://www.gutenberg.org/ebooks/14155.txt.utf-8</a> dans la variable page.</p>
<p>Cette variable est un objet qui contient de <a href="https://requests.readthedocs.io/en/latest/api/#requests.Response">nombreux attributs</a>.</p>
<p>Le <a href="https://requests.readthedocs.io/en/latest/api/#requests.Response.text">texte</a> qui a été téléchargé, au format Unicode :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python">page<span class="token punctuation">.</span>text
</code></pre>
<p>Un fichier téléchargé par internet l'a été octet par octet. Le type par défaut est donc le <code class="language-">bytes</code> et le contenu brut est disponible avec l'attribut <a href="https://requests.readthedocs.io/en/latest/api/#requests.Response.content">content</a> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token builtin">type</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</code></pre>
<p>La bibliothèque fait une conversion pour rendre l'attribut text au format Unicode.</p>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-red-500 bg-red-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
</svg>
<div class="pl-8 mr-8">
<p>La fonction <code class="language-">requests.get</code> va chercher le fichier sur internet. Donc utilisez cette fonction avec parcimonie car les accès réseau sont toujours lents par rapport aux fichiers sur le disque dur en local.</p>
</div>
</div>
<p>L'idéal esr de télécharger le fichier une fois, de le sauver sur votre disque dur puis d'utiliser ensuite tout le temps le fichier sauvegardé. Le code suivant regarde si un fichier donné existe (fonction <a href="https://docs.python.org/fr/3/library/os.path.html#os.path.exists"><code class="language-">os.path.exists</code></a>), et sinon il le télécharge :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">.</span>path

<span class="token keyword">import</span> requests

<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">"mon_fichier.py"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    page <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://www.gutenberg.org/ebooks/14155.txt.utf-8"</span><span class="token punctuation">)</span>
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"mon_fichier.py"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>page<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>


</article>
    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            Cours d'informatique à l'école centrale Marseille
          </p>
        </div>
        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>