<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Partie 1 / 3</title>

    <link href="/cours_informatique/assets/node_modules/prismjs/themes/prism-solarizedlight.css" rel="stylesheet">
    
    <link href="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
    <script src="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script>

    <link href="/cours_informatique/assets/stylesheets/main.css" rel="stylesheet">

  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };

      function goTop() {
        window.scrollTo({top: 0});
      }
      function goBottom() {
        window.scrollTo({top: document.body.scrollHeight});
      }
    </script>
    <script type="text/javascript" id="MathJax-script" src="/cours_informatique/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/cours_informatique/">Home</a>
        </div>

        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <a class="mx-2" href="/cours_informatique/about">About</a>
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </header>

    <main class="max-w-[1200px] mx-auto px-4">
      
<article>

  <h1>Partie 1 / 3</h1>
  <div>
    

    
  </div>

  

  <!-- début résumé -->
<p>Première partie du projet TDD.</p>
<!-- end résumé -->
<h2>1 - départ</h2>
<h3><span id="faire-1.1"></span> Faire</h3>
<p>Commençons par noter ce qu'il faut faire pour que notre application de change fonctionne :</p>
<ul>
<li>il faut plusieurs devises (ici CHF et $)</li>
<li>il faut multiplier les devises par des nombres (nombre d'actions * prix)</li>
</ul>
<p>Cette todo-list (ou <em>backlog</em>) nous indique :</p>
<ol>
<li><strong>ce qu'il faut faire</strong> : dès que on voit une tâche à faire qui n'est pas dans la todo list, on la rajoute,</li>
<li><strong>ce sur quoi on travaille</strong> : on travaillera toujours sur <strong>un unique</strong> item à la fois</li>
<li><strong>ce que l'on a fait</strong> : il n'y a rien de plus satisfaisant que de barrer une ligne que l'on vient de finir.</li>
</ol>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<ol>
<li>Créez un nouveau projet sous vscode dans un dossier que vos appellerez <code class="fichier">projet-tdd</code>.</li>
<li>On a besoin que d'un unique fichier pour l'instant : <code class="fichier">test_monnaie.py</code>.</li>
<li>Prenez également une feuille de papier pour vos todos.</li>
</ol>
</div></div>

<h3><span id="todo-list-1.1"></span> Todo list</h3>
<p>Première todo list :</p>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[ ] \$5 * 2 = \$10</li>
</ul>
<h3><span id="faire-1.2"></span> Faire</h3>
<p>Par quoi on commence ?</p>
<p><strong>PAR UN TEST !</strong></p>
<p>La bonne question n'est donc pas &quot;que fait-on en premier&quot; mais :</p>
<p><strong>Que teste-t-on en premier ?</strong></p>
<p>La deuxième ligne semble la plus simple. Donc allons-y, mettons en <strong>gras</strong> l'item de la todo list qu'on veut faire :</p>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li><strong>[-] \$5 * 2 = \$10</strong></li>
</ul>
<p>Puis :</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Codons un test qui  valide cette item dans le fichier <code class="fichier">test_monnaie.py</code></p>
</div></div>

<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">from</span> monnaie <span class="token keyword">import</span> Dollar


<span class="token keyword">def</span> <span class="token function">test_multiplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cinq <span class="token operator">=</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    cinq<span class="token punctuation">.</span>fois<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    
    <span class="token keyword">assert</span> <span class="token number">10</span> <span class="token operator">==</span> cinq<span class="token punctuation">.</span>montant
</code></pre>
<p>Nous n'avons pas encore écrit de classe <code class="language-">Dollar</code>, mais on l'utilise déjà...</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>En TDD on utilise notre code avant de l'écrire. Avoir une idée de comment utiliser le code nous donne une idée de comment il doit fonctionner.</p>
</div></div>

<p>L'écriture de notre test (un cas d'utilisation de la classe dollar qui valide l'item courant de la todo list) nous montre des choses que l'on doit pouvoir faire, et par là augmente notre todo list avec des choses à implémenter ou des questions auxquelles il va falloir répondre un jour.</p>
<h3><span id="todo-list-1.2"></span> Todo list</h3>
<p>Le test nous pose quelques questions quand à l'utilisation de la classe dollar. Notre todo list devient :</p>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li><strong>[-] \$5 * 2 = \$10</strong></li>
<li>[ ] utiliser <code class="language-">montant</code> ? Le rendre privé (le cacher à l'utilisateur (ici les tests))</li>
<li>[ ] <code class="language-">cinq == $10</code> (ce n'est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-">Dollar</code> non modifiable</li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>
<h3><span id="faire-1.3"></span> Faire</h3>
<p>Rien ne marche avec nos tests lorsqu'on les exécute via le terminal :</p>
<pre class="language-text " style="counter-reset: linenumber 0"><code class="language-text">» python -m pytest test_monnaie.py
======================== test session starts =========================
platform darwin -- Python 3.9.9, pytest-6.2.5, py-1.10.0, pluggy-1.0.0
rootdir: /projet-tdd
plugins: dash-1.19.0, cov-3.0.0
collected 0 items / 1 error

============================== ERRORS ================================
__________________ ERROR collecting test_monnaie.py ___________________
ImportError while importing test module '/projet-tdd/test_monnaie.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
/python3.9/importlib/__init__.py:127: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
test_monnaie.py:1: in <module>
    from money import Dollar
E   ModuleNotFoundError: No module named 'monnaie'
====================== short test summary info =======================
ERROR test_monnaie.py
!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!
========================= 1 error in 0.13s ===========================
</module></code></pre>
<p>Ça en fait des erreurs !</p>
<p>Mais c'est une chance, car les messages d'erreurs vont nous permettre de faire un programme qui fonctionne. Il suffit de les supprimer une à une.</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Apprenez à <strong>lire</strong> les messages d'erreurs !</p>
<p>Il est est souvent plus simple d'exécuter un code et de lire ce qui ne marche pas plutôt qe de réfléchir pour savoir si ça va fonctionner.</p>
</div></div>

<p>On va donc lire attentivement les messages d'erreurs de python et les régler petit à petit. Un message d'erreur <strong>est informatif</strong> si on se force à les lire.</p>
<p>Nos tests ratent à cause d'une erreur. On le voit à cette ligne :</p>
<pre class="language-text " style="counter-reset: linenumber 0"><code class="language-text">E   ModuleNotFoundError: No module named 'monnaie'
</code></pre>
<p>L'erreur est explicite :</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Créez un fichier <code class="fichier">monnaie.py</code> vide dans le projet.</p>
</div></div>

<p>On relance nos tests et maintenant l'erreur est :</p>
<pre class="language-text " style="counter-reset: linenumber 0"><code class="language-text">E   ImportError: cannot import name 'Dollar' from 'monnaie' (/projet-tdd/monnaie.py)
</code></pre>
<p>Encore une fois, l'erreur est explicite : il n'existe pas de module <code class="language-">monnaie</code>. Créons en un :</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Créez une classe <code class="language-">Dollar</code> vide dans le fichier <code class="fichier">monnaie.py</code>.</p>
</div></div>

<p>Pour créer une classe vide, il suffit de mettre une unique instruction <code>pass</code> (qui ne fait rien mais permet de ne pas faire d'erreur lorsque l'on crée un bloc sans instructions) :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre>
<p>On relance nos tests et maintenant l'erreur (toujours explicite) est :</p>
<pre class="language-text " style="counter-reset: linenumber 0"><code class="language-text">    def test_multiplication():
>       cinq = Dollar(5)
E       TypeError: Dollar() takes no arguments
</code></pre>
<p>Qu'à cela ne tienne, ajoutons un argument à la création de dollar :</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Ajoutez un argument à la création d'un objet de la classe <code class="language-">Dollar</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">pass</span>
</code></pre>
</div></div>

<p>On relance nos tests et maintenant :</p>
<pre class="language-text " style="counter-reset: linenumber 0"><code class="language-text">E       AttributeError: 'Dollar' object has no attribute 'fois'
</code></pre>
<p>On sait faire, on ajoute une méthode vide pour que cette erreur disparaisse :</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Ajoutez une méthode <code class="language-">fois</code> vide dans la classe <code class="language-">Dollar</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
 
    <span class="token keyword">def</span> <span class="token function">fois</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> multiplicateur<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre>
</div></div>

<p>On relance nos tests et... encore une erreur. Heureusement, comme toutes les autres elle est facile à résoudre :</p>
<pre class="language-text " style="counter-reset: linenumber 0"><code class="language-text">    def test_multiplication():
        cinq = Dollar(5)
        cinq.fois(2)
    
>       assert 10 == cinq.montant
E       AttributeError: 'Dollar' object has no attribute 'montant'
</code></pre>
<p>On voit de plus que <code class="language-">montant</code> doit être égal à 10, donc vite vite, on corrige cette erreur :</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Ajoutez un attribut <code class="language-">montant</code> qui vaut 10 à tout objet <code class="language-">Dollar</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">=</span> <span class="token number">10</span>
 
    <span class="token keyword">def</span> <span class="token function">fois</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> multiplicateur<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre>
</div></div>

<p>On relance nos tests et...</p>
<pre class="language-text " style="counter-reset: linenumber 0"><code class="language-text">» python -m pytest test_monnaie.py
======================== test session starts =========================
platform darwin -- Python 3.9.9, pytest-6.2.5, py-1.10.0, pluggy-1.0.0
rootdir: /projet-tdd
plugins: dash-1.19.0, cov-3.0.0
collected 1 item
test_monnaie.py .

========================== 1 passed in 0.01s =========================
</code></pre>
<p><strong>Incroyable !</strong> Nos tests passent (c'est émouvant).</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Corriger petit à petit un test pour qu'il passe ne nécessite presque pas d'intelligence. Il suffit de se laisser guider par l'interpréteur python.</p>
</div></div>

<h3><span id="faire-1.4"></span> Faire</h3>
<p><strong>Halte là !</strong> Ce n'est pas fini.</p>
<p>Nos tests passent mais il reste un étape à faire : <strong>refactor</strong> : <em>supprimer les duplications</em>.</p>
<p>La première duplication évidente est le nombre <code class="language-">10</code> du test qui est dupliqué avec le <code class="language-">10</code> du <code class="language-">self.montant</code>. Comme on en a l'habitude maintenant, on va supprimer cette duplication petit à petit :</p>
<p>Après chaque modification, on s'assure que les tests passent : on ne modifie du code que si tout est vert. Ceci nous assure que l'on ne casse pas le programme.</p>
<p>Dans la classe <code class="language-">Dollar</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">=</span> <span class="token number">10</span>

    <span class="token comment"># ...</span>
</code></pre>
<p>Le <code class="language-">10</code> est en fait un <code class="language-">5 * 2</code> (On crée au départ $5).</p>
<p>On effectue la modification :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">2</span>

    <span class="token comment"># ...</span>
</code></pre>
<p>Et on lance nos tests pour vérifier que rien n'est cassé.</p>
<p>Le <code class="language-">5</code> qu'on vient de rajouter est aussi une duplication du test <code class="language-">cinq = Dollar(5)</code>. Modifions alors le code :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">=</span> montant <span class="token operator">*</span> <span class="token number">2</span>

    <span class="token comment"># ...</span>
</code></pre>
<p>Et on vérifie que les tests passent.</p>
<p>Le <code class="language-">2</code> est aussi une duplication, mais elle vient d'une autre ligne du test : <code class="language-">cinq.fois(2)</code>. Commençons donc pas déplacer notre 2 dans la méthode <code class="language-">fois</code> pour voir si c'est possible :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">=</span> montant

    <span class="token keyword">def</span> <span class="token function">fois</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> multiplicateur<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">*=</span> <span class="token number">2</span>

</code></pre>
<p>On lance nos tests... et... ça passe !</p>
<p>On peut supprimer le 2 dans le code de la classe <code class="language-">Dollar</code> et supprimer cette duplication :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">=</span> montant

    <span class="token keyword">def</span> <span class="token function">fois</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> multiplicateur<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">*=</span> multiplicateur

</code></pre>
<p>Nos tests continuent de passer et nous n'avons plus de duplication: on peut supprimer la tâche de la todo list</p>
<h3><span id="todo-list-1.3"></span> Todo list</h3>
<p>Le test nous pose quelques questions quand à l'utilisation de la classe dollar. Notre todo list devient :</p>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[X] \$5 * 2 = \$10</li>
<li>[ ] utiliser <code class="language-">montant</code> ? Le rendre privé (le cacher à l'utilisateur (ici les tests))</li>
<li>[ ] <code class="language-">cinq == $10</code> (ce n'est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-">Dollar</code> non modifiable</li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>
<h4><span id="bilan-1"></span> Bilan</h4>
<p>La procédure utilisée dans cette étape sera générale :</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p><strong>Procédure de programmation en TDD</strong></p>
</div><div class="pl-8 mr-8">
<ol>
<li>on crée un test</li>
<li>on exécute nos tests et on voit que ça ne marche pas. Le test que l'on vient d'écrire est le seul test qui doit rater : <strong>rouge</strong></li>
<li>on change le code pour que nos tests fonctionne. Le but est que le test passe donc on peut commettre les pires atrocités pour cela (comme on a fait en mettant directement 10 à montant par exemple). Pour cela, la façon la plus simple est de se laisser guider par l'interpréteur.</li>
<li>Une fois que les tests passent, on est <strong>vert</strong>. A partir de là, on ne modifiera <strong>jamais</strong> de code si tout les tests ne passent pas</li>
<li>on supprime petit à petit les duplications tout en s'assurant que les tests sont toujours vert</li>
</ol>
</div></div>

<p>La méthode qu'on a utilisé pour faire passer nos tests en dupliquant la réponse du test dans le code à un nom :</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p><strong>Pattern de TDD</strong></p>
</div><div class="pl-8 mr-8">
<p>Dupliquer la réponse du test dans le code est la méthode appelée : *<em><strong>fake it</strong></em>.</p>
</div></div>

<h2>2 - value object</h2>
<p>On veut faire du <strong>clean code that works</strong>. Mais c'est très difficile même pour des très bons codeurs. On va ainsi séparer le problème :</p>
<ol>
<li>on commence par le <em>that works</em></li>
<li>on fini par le <em>clean code</em></li>
</ol>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>La règle d'un bon code est de procéder par ordre :</p>
<ol>
<li>faire du code qui fonctionne</li>
<li>faire du code propre</li>
<li>faire du code rapide</li>
</ol>
<p>Il ne faut cependant pas s'arrêter à 1, sinon votre code ne sera pas maintenable dans le temps.</p>
</div></div>

<p>Que faire maintenant ?</p>
<h3><span id="todo-list-2.1"></span> Todo list</h3>
<p>On choisit <strong>toujours</strong> l'élément le plus simple à faire dans la todo list. Ici, le quatrième item semble le facilement implémentable :</p>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[X] \$5 * 2 = \$10</li>
<li>[ ] utiliser <code class="language-">montant</code> ? Le rendre privé (le cacher à l'utilisateur (ici les tests))</li>
<li><strong>[-] <code class="language-">cinq == $10</code> (ce n'est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-">Dollar</code> non modifiable</strong></li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>
<h3><span id="faire-2.1"></span> Faire</h3>
<p>Pour vérifier que nos 5 dollars restent 5 dollars, on peut faire un test du style :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">from</span> money <span class="token keyword">import</span> Dollar

<span class="token keyword">def</span> <span class="token function">test_multiplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cinq <span class="token operator">=</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    cinq<span class="token punctuation">.</span>fois<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        
    <span class="token keyword">assert</span> <span class="token number">10</span> <span class="token operator">==</span> cinq<span class="token punctuation">.</span>montant

    cinq<span class="token punctuation">.</span>fois<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        
    <span class="token keyword">assert</span> <span class="token number">15</span> <span class="token operator">==</span> cinq<span class="token punctuation">.</span>montant
</code></pre>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>On exécute nos tests et — comme attendu — ça rate.</p>
</div></div>

<p>Ce test n'est cependant pas vraiment satisfaisant pour au moins deux raisons :</p>
<ol>
<li>cela semble un peut compliqué de changer montant tout en gardant 5 quelque-part</li>
<li>le code est vraiment étrange. Comment <code class="language-">cinq</code> pourrait-il valoir 15 ?</li>
</ol>
<p>La seconde raison est de loin la plus importante. Notre code est étrange et peu lisible (bref, <em>ça ne sent pas bon</em>). C'est souvent le signe qu'il se passe quelque chose de mal.</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Le <strong><a href="https://en.wikipedia.org/wiki/Code_smell">code smell</a></strong> est la capacité qu'à un bon développeur de reconnaître un soucis profond juste en lisant l'organisation ou l'utilisation d'un code.</p>
<p>Le <em>code smell</em> s'acquiert avec le temps, mais vous pouvez accélérer son acquisition en lisant du bon code</p>
</div></div>

<p>Une façon simple et élégante de régler notre soucis est d'utiliser des objet qui ne peuvent être modifiés.</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Un objet non modifiable est appelé <a href="https://martinfowler.com/bliki/ValueObject.html"><strong>value object</strong></a>.</p>
</div></div>

<p>C'est super chouette d'avoir des objets non modifiable, on a pas besoin de faire attention à eux : une fois créés ils ne bougent plus.</p>
<p>Ceci nous permet de les donner à des méthodes inconnues sans avoir peur qu'ils soient modifiés, ou les utiliser dans nos propres méthodes sans craindre qu'ils soient modifiés plus tard. Le seul point négatif d'un value object est que l'on doit recréer un nouvel objet si on veut le changer. Heureusement, dans la plupart du temps ce n'est pas très coûteux.</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
<div class="pl-8 mr-8">
<p>En python, de nombreux objet sont des values object. On peut citer les chaines de caractères, les entiers, les réels ou encore le booléens.</p>
<p>De plus, de nombreuses structures modifiables ont leurs contrepartie non modifiables. Par exemple les <a href="https://docs.python.org/fr/3/library/stdtypes.html">tuples</a> pour les listes ou les <a href="https://docs.python.org/fr/3/library/stdtypes.html">frozenset</a> pour les ensembles.</p>
</div></div>

<p>Pour un <em>value object</em>, à la place de modifier un objet il faut en rendre un nouveau : la méthode <code class="language-">fois</code> doit rendre un objet. Modifions notre test  :</p>
<p>Fichier <code class="fichier">test_monnaie.py</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">from</span> monnaie <span class="token keyword">import</span> Dollar


<span class="token keyword">def</span> <span class="token function">test_multiplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cinq <span class="token operator">=</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    dix <span class="token operator">=</span> cinq<span class="token punctuation">.</span>fois<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token keyword">assert</span> <span class="token number">10</span> <span class="token operator">==</span> dix<span class="token punctuation">.</span>montant

    quinze <span class="token operator">=</span> cinq<span class="token punctuation">.</span>fois<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">assert</span> <span class="token number">15</span> <span class="token operator">==</span> quinze<span class="token punctuation">.</span>montant

</code></pre>
<p>Le test est bien plus joli : il est lisible et compréhensible. Bon bien sur, ce n'est que le début :</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>On exécute nos tests et — comme attendu — ça rate.</p>
</div></div>

<p>Ce coup ci, pas besoin de grandes manipulations pour faire passer le test. Il faut que la méthode <em>fois</em> rende un objet <code class="language-">Dollar</code>. Si l'implémentation semble évidente, autant la coder de suite (mais après le test !).  On vient de découvrir une autre règle :</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p><strong>Pattern de TDD</strong></p>
</div><div class="pl-8 mr-8">
<p>L'implémentation directe du test est appelée : <em><strong>obvious implementation</strong></em>.</p>
</div></div>

<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Faite une implémentation de la méthode <code class="language-">fois</code></p>
</div></div>

<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block">
<p>solution</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2">
<p>Fichier <code class="fichier">monnaie.py</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">=</span> montant

    <span class="token keyword">def</span> <span class="token function">fois</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> multiplicateur<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Dollar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>montant <span class="token operator">*</span> multiplicateur<span class="token punctuation">)</span>
</code></pre>
</div>
</details>     
</div>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>On exécute nos tests et ça passe !</p>
</div></div>

<p>On a en même temps fait passer le test et fini l'implémentation.</p>
<h3><span id="todo-list-2.2"></span> Todo list</h3>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[X] \$5 * 2 = \$10</li>
<li>[ ] utiliser <code class="language-">montant</code> ? Le rendre privé (le cacher à l'utilisateur (ici les tests))</li>
<li>[X] <code class="language-">cinq == $10</code> (ce n'est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-">Dollar</code> non modifiable</li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>
<h2>3 - <code class="language-">==</code></h2>
<p>Pour vérifier que deux objets sont égaux, on ne va pas passer son temps à vérifier que tous leurs attributs soient les mêmes. On va le faire une fois pour toute (ce qui évitera en plus les duplications). On le rajoute donc dans la todo list :</p>
<h3><span id="todo-list-3.1"></span> Todo list</h3>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[X] \$5 * 2 = \$10</li>
<li>[ ] utiliser <code class="language-">montant</code> ? Le rendre privé (le cacher à l'utilisateur (ici les tests))</li>
<li>[X] <code class="language-">cinq == $10</code> (ce n'est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-">Dollar</code> non modifiable</li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
<li><strong>[-] <code class="language-">==</code></strong></li>
</ul>
<h3><span id="faire-3.1"></span> Faire</h3>
<p>On va utiliser pour cela des méthodes spéciales de python qui permettent d'utiliser les opérateurs <code class="language-">==</code> et <code class="language-">!=</code> même si ce n'est pas pour comparer des entiers. Mais avant d'aller plus loin, les tests.</p>
<p>Fichier <code class="fichier">test_monnaie.py</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token comment"># ...</span>

<span class="token keyword">def</span> <span class="token function">test_egalite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment"># ...</span>
</code></pre>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>On lance les tests.</p>
</div></div>

<p>Bien sur, le test rate. Par défaut, lorsque l'on a pas défini de méthode <code class="language-">__eq__</code>, l'opérateur <code class="language-">==</code> regarde si ce sont les mêmes objets, ce qui n'est pas le cas.</p>
<p>L'implémentation n'étant pas forcément évidente :</p>
<p>Commençons par faire marcher le test en utilisant la technique <em>fake it</em> :</p>
<p>Fichier <code class="fichier">monnaie.py</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>amount <span class="token operator">=</span> amount

    <span class="token keyword">def</span> <span class="token function">times</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> multiplier<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Dollar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>amount <span class="token operator">*</span> multiplier<span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
</code></pre>
<p>Avec ce code lorsque l'on écrit <code class="language-">x == y</code>, python le re-écrit en : <code class="language-">x.__eq__(y)</code>. Du coup notre <em>fake it</em> fait passer le test.</p>
<p>Maintenant, les choses sérieuses : on supprime les duplications. On suppose que l'on ne sait pas résoudre le problème. Pour trouver une solution, on utilise le dernier pattern du TDD :</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p><strong>Pattern de TDD</strong></p>
</div><div class="pl-8 mr-8">
<p>Pour supprimer ds duplications non évidente on utilise la <em><strong>triangulation</strong></em></p>
</div></div>

<p>Pour utiliser la triangulation, on écrit deux tests différents pour le même problème : si le test est différent du premier, pour que les deux testent passent en même temps, il faudra supprimer des duplications.</p>
<p>On ajoute alors autant de tests que nécessaire jusqu'à ce que toutes les duplications aient disparues. Les tests que l'on rajoute dépendent donc des duplications que l'on a.</p>
<p>Dans notre cas, on répond toujours <code class="language-">True</code>, on va donc forger un test qui doit répondre <code class="language-">False</code>.</p>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-orange-500 bg-orange-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-orange-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
<div class="pl-8 mr-8">
<p>Créez un test qui répond <code class="language-">False</code> à l'égalité</p>
</div></div>

<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block">
<p>solution</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2">
<p>Fichier <code class="fichier">test_monnaie.py</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token comment"># ...</span>

<span class="token keyword">def</span> <span class="token function">test_egalite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">test_non_egalite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">!=</span> Dollar<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>

<span class="token comment"># ...</span>
</code></pre>
</div>
</details>     
</div>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>On lance les tests et maintenant un teste rate.</p>
</div></div>

<p>La duplication est dans le montant de l'objet.</p>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-orange-500 bg-orange-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-orange-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
<div class="pl-8 mr-8">
<p>Supprimez la duplication de la méthode <code class="language-">__eq__</code>.</p>
</div></div>

<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block">
<p>solution</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2">
<p>Fichier <code class="fichier">monnaie.py</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>montant <span class="token operator">==</span> other<span class="token punctuation">.</span>montant
</code></pre>
</div>
</details>     
</div>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-yellow-500 bg-yellow-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
</svg>
<div class="pl-8 mr-8">
<p>On peut maintenant re-exécuter le test, qui passe.</p>
</div></div>

<p>Ce traitement de l'égalité est frustre, on ne vérifie pas :</p>
<ul>
<li>si l'objet <code class="language-">other</code> a la propriété <code class="language-">montant</code></li>
<li>voir même si l'objet existe (<code class="language-">cinq == None</code> va planter plutôt que de répondre <code class="language-">False</code>)</li>
</ul>
<p>On va pas s'embêter avec ça pour l'instant, mais on va tout de même le rajouter à notre todo list.</p>
<h3><span id="todo-list-3.2"></span> Todo list</h3>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[X] \$5 * 2 = \$10</li>
<li>[ ] utiliser <code class="language-">montant</code> ? Le rendre privé (le cacher à l'utilisateur (ici les tests))</li>
<li>[X] <code class="language-">cinq == $10</code> (ce n'est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-">Dollar</code> non modifiable</li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
<li>[X] <code class="language-">==</code></li>
<li>[ ] <code class="language-">== None</code></li>
<li>[ ] <code class="language-">==</code> avec autre chose qu'un <code class="language-">Dollar</code></li>
</ul>
<h2>4 - <code class="language-">__mul__</code></h2>
<p>La méthode <code class="language-">__eq__</code> n'est pas la seule utilisée en python pour donner des comportement spéciaux au objets (il en <a href="https://micropyramid.com/blog/python-special-class-methods-or-magic-methods/">existe beaucoup d'autres</a>. Notre objet <code class="language-">Dollar</code> devant se comporter plus ou moins comme un nombre, on peut implémenter les <a href="https://spaneintopython3.net/special-method-names.html#acts-like-number">méthodes spéciales utiles pour ressembler à des nombres</a>.</p>
<p>Commençons par implémenter <a href="https://docs.python.org/3/library/operator.html#operator.__mul__"><code class="language-">__mul__</code></a>.</p>
<h3><span id="todo-list-4.1"></span> Todo list</h3>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[X] \$5 * 2 = \$10</li>
<li>[ ] utiliser <code class="language-">montant</code> ? Le rendre privé (le cacher à l'utilisateur (ici les tests))</li>
<li>[X] <code class="language-">cinq == $10</code> (ce n'est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-">Dollar</code> non modifiable</li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
<li>[X] <code class="language-">==</code></li>
<li>[ ] <code class="language-">== None</code></li>
<li>[ ] <code class="language-">==</code> avec autre chose qu'un <code class="language-">Dollar</code></li>
<li><strong>[-] <code class="language-">__mul__</code></strong></li>
</ul>
<h3><span id="faire-4.1"></span> Faire</h3>
<p>Pour le test, il suffit de modifier le test de la multiplication :</p>
<p>Fichier <code class="fichier">test_monnaie.py</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token comment"># ...</span>

<span class="token keyword">def</span> <span class="token function">test_multiplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cinq <span class="token operator">=</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    dix <span class="token operator">=</span> cinq <span class="token operator">*</span> <span class="token number">2</span>

    <span class="token keyword">assert</span> <span class="token number">10</span> <span class="token operator">==</span> dix<span class="token punctuation">.</span>montant

    quinze <span class="token operator">=</span> cinq <span class="token operator">*</span> <span class="token number">3</span>

    <span class="token keyword">assert</span> <span class="token number">15</span> <span class="token operator">==</span> quinze<span class="token punctuation">.</span>montant

<span class="token comment"># ...</span>
</code></pre>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-orange-500 bg-orange-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-orange-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
<div class="pl-8 mr-8">
<p>En faire une <em>obvious implementation</em> :</p>
</div></div>

<div class="relative drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-indigo-500 bg-indigo-100">
<details class="group">
<summary class="list-none py-0.5">
<svg class="group-open:hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
</svg>
<svg class="group-open:block hidden absolute w-7 h-7 pl-1 pt-0.5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
</svg>
<div class="pl-8 font-bold inline-block">
<p>solution</p>
</div>
<svg class="group-open:hidden inline-block pl-3 w-10 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
</svg>
</summary>
<div class="mx-8 pb-2">
<p>Fichier <code class="fichier">monnaie.py</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">=</span> montant

    <span class="token keyword">def</span> <span class="token function">__mul__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> multiplicateur<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Dollar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>montant <span class="token operator">*</span> multiplicateur<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>montant <span class="token operator">==</span> other<span class="token punctuation">.</span>montant

</code></pre>
</div>
</details>     
</div>
<h3><span id="todo-list-4.2"></span> Todo list</h3>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[X] \$5 * 2 = \$10</li>
<li>[ ] utiliser <code class="language-">montant</code> ? Le rendre privé (le cacher à l'utilisateur (ici les tests))</li>
<li>[X] <code class="language-">cinq == $10</code> (ce n'est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-">Dollar</code> non modifiable</li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
<li>[X] <code class="language-">==</code></li>
<li>[ ] <code class="language-">== None</code></li>
<li>[ ] <code class="language-">==</code> avec autre chose qu'un <code class="language-">Dollar</code></li>
<li>[X] <code class="language-">__mul__</code></li>
</ul>
<h2>5 - privacy</h2>
<p>Tout est prêt pour travailler sur l'attribut <code class="language-">montant</code>.</p>
<h3><span id="todo-list-5.1"></span>  Todo list</h3>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[X] \$5 * 2 = \$10</li>
<li><strong>[-] utiliser <code class="language-">montant</code> ? Le rendre privé (le cacher à l'utilisateur (ici les tests))</strong></li>
<li>[X] <code class="language-">cinq == $10</code> (ce n'est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-">Dollar</code> non modifiable</li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
<li>[X] <code class="language-">==</code></li>
<li>[ ] <code class="language-">== None</code></li>
<li>[ ] <code class="language-">==</code> avec autre chose qu'un <code class="language-">Dollar</code></li>
<li>[X] <code class="language-">__mul__</code></li>
</ul>
<h3><span id="faire-5.1"></span> Faire</h3>
<p>Il ne manque pas grand chose pour que <code class="language-">montant</code> soit privé. Il suffit de ne pas en parler dans les tests et de ne comparer que des objets entres eux :</p>
<p>Fichier <code class="fichier">test_monnaie.py</code> :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token comment"># ...</span>

<span class="token keyword">def</span> <span class="token function">test_multiplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cinq <span class="token operator">=</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

    dix <span class="token operator">=</span> cinq <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">==</span> dix

    quinze <span class="token operator">=</span> cinq <span class="token operator">*</span> <span class="token number">3</span>
    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">==</span> quinze

<span class="token comment">#... </span>
</code></pre>
<p>On peut même encore faire plus joli :</p>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token comment"># ...</span>

<span class="token keyword">def</span> <span class="token function">test_multiplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cinq <span class="token operator">=</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">==</span> cinq <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">==</span> cinq <span class="token operator">*</span> <span class="token number">3</span>

<span class="token comment">#... </span>
</code></pre>
<p>Notez que l'on a utilisé une fonctionnalité que l'on vient de créer (<code class="language-">__mul__</code>) pour améliorer un test. C'est normal les tests et le code forment une seule entité.</p>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-red-500 bg-red-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Maintenant si 2 tests plantent en même temps (si le <code class="language-">==</code> commence à rater par exemple), il faudra se rappeler quel est le test qui plante et les tests qui ne fonctionnent plus.</p>
<p>Ceci arrive inévitablement.</p>
</div></div>

<p>On fait petit à petit disparaître des tests les références explicites à l'implémentation des classes. C'est une bonne pratique.</p>
<div class="quote relative drop-shadow  py-2 pr-2 rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-amber-800 bg-amber-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-amber-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
<div class="pl-8 mb-2 mr-8">
<p><strong>Test pattern</strong></p>
</div><div class="pl-8 mr-8">
<p>Lorsque l'on teste, il est important de toujours tester du point de vue de l'utilisation. Il faut éviter le plus possible de tester des attributs internes à la classe.</p>
</div></div>

<h3><span id="todo-list-5.2"></span> Todo list</h3>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[X] \$5 * 2 = \$10</li>
<li>[X] utiliser <code class="language-">montant</code> ? Le rendre privé (le cacher à l'utilisateur (ici les tests))</li>
<li>[X] <code class="language-">cinq == $10</code> (ce n'est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-">Dollar</code> non modifiable</li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
<li>[X] <code class="language-">==</code></li>
<li>[ ] <code class="language-">== None</code></li>
<li>[ ] <code class="language-">==</code> avec autre chose qu'un <code class="language-">Dollar</code></li>
<li>[X] <code class="language-">__mul__</code></li>
</ul>
<h2>Fin de la partie 1</h2>
<h3><span id="todo-list-fin-1"></span> Todo list</h3>
<p>On peut épurer notre todo list en supprimant les items déjà résolus. On obtient :</p>
<ul>
<li>[ ] \$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
<li>[ ] gestion des arrondis (lorsque les montants seront des réels)</li>
<li>[ ] <code class="language-">== None</code></li>
<li>[ ] <code class="language-">==</code> avec autre chose qu'un <code class="language-">Dollar</code></li>
</ul>
<h3><span id="code-fin-1"></span> Code</h3>
<p>A la fin de cette partie, on a 2 fichiers.</p>
<h4><code class="fichier">monnaie.py</code></h4>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Dollar</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> montant<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>montant <span class="token operator">=</span> montant

    <span class="token keyword">def</span> <span class="token function">__mul__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> multiplicateur<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Dollar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>montant <span class="token operator">*</span> multiplicateur<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>montant <span class="token operator">==</span> other<span class="token punctuation">.</span>montant

</code></pre>
<h4><code class="fichier">test_monnaie.py</code></h4>
<pre class="language-python " style="counter-reset: linenumber 0"><code class="language-python"><span class="token keyword">from</span> monnaie <span class="token keyword">import</span> Dollar


<span class="token keyword">def</span> <span class="token function">test_multiplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cinq <span class="token operator">=</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">==</span> cinq <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">==</span> cinq <span class="token operator">*</span> <span class="token number">3</span>


<span class="token keyword">def</span> <span class="token function">test_egalite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">test_non_egalite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> Dollar<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">!=</span> Dollar<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>

</code></pre>


</article>
    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            Cours d'informatique de François Brucker
          </p>
        </div>
        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>