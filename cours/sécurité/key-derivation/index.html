<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Key derivation</title>

    

    <link href="https://prismjs.catppuccin.com/latte.css" rel="stylesheet">

    <link href="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
    <script src="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script>
    
    <link href="/cours_informatique/assets/stylesheets/main.css" rel="stylesheet">

  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };

      function goTop() {
        window.scrollTo({top: 0});
      }
      function goBottom() {
        window.scrollTo({top: document.body.scrollHeight});
      }
    </script>
    <script type="text/javascript" id="MathJax-script" src="/cours_informatique/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/cours_informatique/">Home</a>
        </div>

        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <a class="mx-2" href="/cours_informatique/about">About</a>
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </header>

    <main class="max-w-[1200px] mx-auto px-4">
      
<article>

  <h1>Key derivation</h1>
  <div>
    

    
  </div>

  

    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a class="interne" href="/cours_informatique/cours/">Cours</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/sécurité/">Sécurité</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/sécurité/key-derivation/">Key derivation</a>

</div></div>



    
  

  <div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<ul>
<li><a href="https://en.wikipedia.org/wiki/Key_derivation_function">Définition</a></li>
<li><a href="https://blog.boot.dev/cryptography/key-derivation-functions/">introduction</a></li>
</ul>
</div></div>

<p>Lors d'un session de transport on a souvent besoin de nombreuses clés, puisqu'il ne faut <strong>jamais</strong> répéter les clés. La <em>Key derivation</em> est un moyen de créer des clés à partir d'un mot de passe et de sel.</p>
<p>Son autre avantage est de permettre de créer des clé de taille donné et de permettre de rendre plus uniforme une distribution de mots de passe (par exemple les mots de passes issus d'un échange de clé par Diffie-Hellman).</p>
<h2>Principe</h2>
<p>La façon la plus simple, si on a un PRF sous la main est de :</p>
<ul>
<li>posséder une clé primaire appelée $SK$ (<em>source key</em>)</li>
<li>une constante $\text{iv}$, application dépendante pour éviter que plusieurs applications différentes utilisant la même clé primaires de se trouvent avec les mêmes clés</li>
</ul>
<p>Puis il suffit d'étier le process à chaque fois que l'in veut une clé avec : $F(\text{SK}, \text{iv} || i)$, où $\text{iv}$ un texte désignant le type de mot de passe concernée et $i$ un nombre comptant le nombre de mots de passe que l'application a demandé.</p>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<ul>
<li><a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a></li>
<li><a href="https://www.youtube.com/watch?v=gTaOccTY9bc">https://www.youtube.com/watch?v=gTaOccTY9bc</a></li>
</ul>
</div></div>

<p>Nous allons montrer préciser le principe en explicitant le protocole <code>PBKDF2</code> encore très utilisé aujourd'hui. On lui préférera tout de même <a href="https://en.wikipedia.org/wiki/Argon2">argon2</a>, plus complexe, pour de nouvelles applications.</p>
<pre class="language-sh" tabindex="0" data-language="sh"><code class="language-sh">❯ openssl kdf <span class="token parameter variable">-keylen</span> <span class="token number">32</span> <span class="token parameter variable">-kdfopt</span> digest:SHA256 <span class="token parameter variable">-kdfopt</span> pass:<span class="token string">"password"</span> <span class="token parameter variable">-kdfopt</span> salt:<span class="token string">""</span> <span class="token parameter variable">-kdfopt</span> iter:2 PBKDF2
8B:C2:F9:16:7A:81:CD:CF:AD:12:35:CD:90:47:F1:13:62:71:C1:F9:78:FC:FC:B3:5E:22:DB:EA:FA:46:34:F6</code></pre>
<p><code>DK = PBKDF2(HMAC, Password, Salt, c, n)</code></p>
<p>avec <code>DK = T1 || T2 || ... || Tn</code></p>
<p>Les <code>Ti</code> sont de la taille de la sortie du hash.</p>
<p>Et sont générés par : <code>Ti = U1 ⊕ ... ⊕ Uc</code> avec :</p>
<ul>
<li><code>U1 = HMAC(Password, salt || i)</code></li>
<li><code>Uj = HMAC(Password, U{j-1})</code></li>
</ul>
<p>On vot que l'itération des fonctions de hash permet d'uniformiser le hash.</p>
<h2>Argon2</h2>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<ul>
<li><a href="https://www.youtube.com/watch?v=Sc3aHMCc4h0">Argon2 algorithm</a></li>
<li><a href="https://mojoauth.com/compare-hashing-algorithms/argon2-vs-pbkdf2/">Argon2 vs PBKDF2</a></li>
</ul>
</div></div>

<p>Argon2 est le gagnant d'une compétition visant à trouver le meilleur hash de mot de passes. Le principe est le même que pour <code>PBKDF2</code> mais est plus résistant aux attaques brutes force et/ou side channel attack.</p>
<pre class="language-shell" tabindex="0" data-language="shell"><code class="language-shell">❯ openssl kdf <span class="token parameter variable">-keylen</span> <span class="token number">50</span> <span class="token parameter variable">-kdfopt</span> pass:<span class="token string">"password"</span> <span class="token parameter variable">-kdfopt</span> salt:<span class="token string">'des grains de sel'</span> <span class="token parameter variable">-kdfopt</span> iter:3  ARGON2D
A6:0E:10:5D:A0:6A:63:85:8A:1A:63:25:8E:99:F2:7C:C6:00:F3:23:BE:09:F6:91:62:E5:FD:B6:5F:DA:CF:C0</code></pre>
<pre class="language-shell" tabindex="0" data-language="shell"><code class="language-shell">❯ <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"password"</span> <span class="token operator">|</span> argon2 <span class="token string">"des grains de sel"</span> <span class="token parameter variable">-l</span> <span class="token number">50</span>
Type:           Argon2i
Iterations:     <span class="token number">3</span>
Memory:         <span class="token number">4096</span> KiB
Parallelism:    <span class="token number">1</span>
Hash:           62ac773d564f583c593e6091c72eeb48766fc1d1e314afdce0bc175328e98afbca29a5078035152cdac35d2720d9cc6cb4e3
Encoded:        <span class="token variable">$argon2i</span><span class="token variable">$v</span><span class="token operator">=</span><span class="token number">19</span><span class="token variable">$m</span><span class="token operator">=</span><span class="token number">4096</span>,t<span class="token operator">=</span><span class="token number">3</span>,p<span class="token operator">=</span><span class="token number">1</span><span class="token variable">$ZGVzIGdyYWlucyBkZSBzZWw</span><span class="token variable">$Yqx3PVZPWDxZPmCRxy7rSHZvwdHjFK</span>/c4LwXUyjpivvKKaUHgDUVLNrDXScg2cxstOM
<span class="token number">0.014</span> seconds
Verification ok
</code></pre>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-red-500 bg-red-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Attention, tous les paramètres sont importants. Trouver le même hash avec openssl et argon2 semble impossible.</p>
</div></div>

<ul>
<li>renforcement de la clé primaire : hash</li>
<li>clé primaire puis dérivation.</li>
</ul>
<h2>Usage</h2>
<div class="quote relative py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-emerald-500 bg-emerald-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-emerald-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>
</svg>
<div class="pl-8 mr-8">
<p><a href="https://blog.trailofbits.com/2025/01/28/best-practices-for-key-derivation/">Usage</a></p>
</div></div>

<p>Trois usages courant :</p>
<ul>
<li>password hashing</li>
<li>key stretching</li>
<li>key derivation</li>
</ul>


</article>
    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            Cours d'informatique de François Brucker
          </p>
        </div>
        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>